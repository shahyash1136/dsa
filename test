import { render, screen, fireEvent } from '@testing-library/react';
import MyComponent from './MyComponent'; // Adjust the import based on your file structure

describe('MyComponent', () => {
  let inputValue;
  let setInputValue;
  let onInputChange;

  beforeEach(() => {
    inputValue = '';
    setInputValue = jest.fn((updater) => {
      // Call the updater function with the current inputValue
      inputValue = typeof updater === 'function' ? updater(inputValue) : updater;
    });
    onInputChange = jest.fn(); // Mock onInputChange
  });

  it('removes trailing comma on blur', () => {
    inputValue = 'test,'; // Set initial value with trailing comma

    render(
      <MyComponent 
        label="Test Label" 
        inputValue={inputValue} 
        setInputValue={setInputValue} 
        onInputChange={onInputChange} 
        dataTestId="my-input"
      />
    );

    const input = screen.getByTestId('my-input');
    
    // Simulate blur event
    fireEvent.blur(input);
    
    // Check if setInputValue was called with 'test' (trailing comma removed)
    expect(setInputValue).toHaveBeenCalledWith(expect.any(Function));
    
    // Call the function to simulate the state update
    const updater = setInputValue.mock.calls[0][0]; // Get the first call's function
    updater(inputValue); // Call it with the initial value

    // Check the new value after the update
    expect(inputValue).toBe('test');
  });

  it('keeps value unchanged if no trailing comma on blur', () => {
    inputValue = 'test'; // Set initial value without trailing comma

    render(
      <MyComponent 
        label="Test Label" 
        inputValue={inputValue} 
        setInputValue={setInputValue} 
        onInputChange={onInputChange} 
        dataTestId="my-input"
      />
    );

    const input = screen.getByTestId('my-input');
    
    // Simulate blur event
    fireEvent.blur(input);
    
    // Check if setInputValue was called with the function
    expect(setInputValue).toHaveBeenCalledWith(expect.any(Function));

    // Call the function to simulate the state update
    const updater = setInputValue.mock.calls[0][0]; // Get the first call's function
    updater(inputValue); // Call it with the initial value

    // Check the value remains unchanged
    expect(inputValue).toBe('test');
  });
});
