import axios from 'axios';
import service from './service'; // Import your service

// Mock the entire axios module
jest.mock('axios');

// Mock the axios.create() method and the instance it returns
const mockRequest = jest.fn();
const mockCreate = jest.fn(() => ({
  request: mockRequest,
  interceptors: {
    request: { use: jest.fn(), eject: jest.fn() },
    response: { use: jest.fn(), eject: jest.fn() }
  },
  defaults: {
    baseURL: '$multiCpBaseUrl'
  }
}));

axios.create = mockCreate;

describe('Axios Service', () => {
  let mockConfig;

  beforeEach(() => {
    mockConfig = { url: '/test', method: 'get' };
  });

  it('should have the correct baseURL', () => {
    expect(service.defaults.baseURL).toBe('$multiCpBaseUrl');
  });

  it('should pass request configuration unchanged in request interceptor', async () => {
    // Mock successful request
    mockRequest.mockResolvedValue({ data: {} });

    // Trigger the request
    const response = await service(mockConfig);

    // Expect the request config to remain the same
    expect(mockRequest).toHaveBeenCalledWith(mockConfig);
    expect(response).toEqual({});
  });

  it('should handle request error in request interceptor', async () => {
    const testError = new Error('Request error');

    // Mock request error
    mockRequest.mockRejectedValue(testError);

    // Call the service and expect it to throw the error
    await expect(service(mockConfig)).rejects.toThrow(testError);
  });

  it('should return response data from the response interceptor', async () => {
    const mockData = { message: 'success' };

    // Mock successful response
    mockRequest.mockResolvedValue({ data: mockData });

    const response = await service(mockConfig);

    // Expect the response data to be passed through the response interceptor
    expect(response).toEqual(mockData);
  });

  it('should handle response error in response interceptor', async () => {
    const testError = new Error('Response error');

    // Mock failed response
    mockRequest.mockRejectedValue(testError);

    // Call the service and expect it to throw the error
    await expect(service(mockConfig)).rejects.toThrow(testError);
  });
});
